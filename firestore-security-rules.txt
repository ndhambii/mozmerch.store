# Firestore Security Rules for MozMerch Waitlist
# Copy these rules to your Firebase Console > Firestore > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow only authenticated writes to waitlist collection
    // and restrict to specific fields with validation
    match /waitlist/{documentId} {
      // Only allow writes (create/update) - no reads from frontend
      allow write: if request.auth == null 
        && request.resource.data.keys().hasAll(['email', 'profileType', 'comment', 'createdAt', 'source', 'ua', 'ip', 'version'])
        && request.resource.data.email is string
        && request.resource.data.email.matches('.*@.*\\..*')
        && request.resource.data.email.size() <= 254
        && request.resource.data.profileType in ['Marca MoÃ§ambicana', 'Artista / Criativo', 'Utilizador', '']
        && request.resource.data.comment is string
        && request.resource.data.comment.size() <= 500
        && request.resource.data.source is string
        && request.resource.data.source.size() <= 100
        && request.resource.data.ua is string
        && request.resource.data.ua.size() <= 200
        && request.resource.data.ip == 'anonymous'
        && request.resource.data.version == '1.0';
      
      // Deny all reads from frontend
      allow read: if false;
    }
    
    // Deny access to all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

# Additional Security Recommendations:
# 1. Enable Firebase App Check for additional protection
# 2. Set up monitoring and alerting for suspicious activity
# 3. Consider rate limiting at the application level
# 4. Regularly review and update these rules
